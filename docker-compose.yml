# MinIO (S3-compatible) pour tester le stockage S3 en plus du stockage local.
# Usage: docker compose up -d
# Console MinIO: http://localhost:9001 (minioadmin / minioadmin par défaut)
# Créer un bucket "demo" dans la console pour le filesystem s3 de la démo.

services:
  minio:
    image: minio/minio:latest
    container_name: filesystem-bundle-minio
    ports:
      - "9000:9000"   # API S3
      - "9001:9001"   # Console web
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-minioadmin}
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data

  # Crée le bucket "demo" au premier démarrage (attend que MinIO soit prêt)
  minio-init:
    image: minio/mc:latest
    container_name: filesystem-bundle-minio-init
    depends_on:
      - minio
    entrypoint: >
      /bin/sh -c "
      sleep 5;
      mc alias set myminio http://minio:9000 $${MINIO_ROOT_USER:-minioadmin} $${MINIO_ROOT_PASSWORD:-minioadmin};
      mc mb myminio/demo --ignore-existing;
      echo 'Bucket demo prêt.';
      "
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-minioadmin}

volumes:
  minio_data: {}
